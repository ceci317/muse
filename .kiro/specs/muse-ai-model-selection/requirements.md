# Muse AI模型选择功能 - 需求文档

## 1. 项目概述

为Muse应用添加多AI模型支持，允许用户在Gemini和阿里云百炼平台之间选择，提供更灵活的AI服务选项。

## 2. 功能需求

### 2.1 模型选择界面
**作为用户，我希望能够选择使用的AI模型，以便根据个人偏好和服务可用性选择最适合的AI服务。**

**验收标准：**
- 在设置界面中添加AI模型选择选项
- 支持Gemini和阿里云百炼两种模型
- 用户选择会被持久化保存
- 界面风格与现有Muse设计保持一致

### 2.2 阿里云百炼API集成
**作为用户，我希望能够配置阿里云百炼的API密钥，以便使用该服务。**

**验收标准：**
- 提供阿里云百炼API Key配置界面
- API Key安全存储在本地
- 支持API Key的验证和测试
- 提供获取API Key的指导链接

### 2.3 统一的AI调用接口
**作为开发者，我希望有统一的AI调用接口，以便在不同模型间无缝切换。**

**验收标准：**
- 创建统一的AI服务抽象层
- 支持相同的调用参数和返回格式
- 错误处理统一化
- 支持模型特定的配置参数

### 2.4 现有功能兼容性
**作为用户，我希望所有现有功能在切换模型后仍能正常工作。**

**验收标准：**
- 幻想编剧功能支持两种模型
- 互动故事功能支持两种模型  
- Oracle占卜功能支持两种模型
- 窥探心声功能支持两种模型

### 2.5 用户体验优化
**作为用户，我希望能够了解当前使用的模型状态，以便做出合适的选择。**

**验收标准：**
- 显示当前选择的模型
- 提供模型切换的快捷方式
- 在API调用失败时提供清晰的错误信息
- 支持模型可用性检测

## 3. 非功能性需求

### 3.1 性能要求
- API调用响应时间应在合理范围内
- 模型切换应该是即时的
- 不影响现有功能的性能

### 3.2 安全要求
- API密钥必须安全存储
- 不在网络传输中暴露敏感信息
- 支持API密钥的安全删除

### 3.3 兼容性要求
- 保持与现有代码的向后兼容
- 支持渐进式迁移
- 不破坏现有用户数据

## 4. 技术约束

### 4.1 现有技术栈
- 基于v10.html的单页面应用
- 使用Tailwind CSS样式框架
- JavaScript原生实现
- 本地存储用于数据持久化

### 4.2 API要求
- 支持阿里云百炼的REST API
- 保持与Gemini API相似的调用模式
- 处理不同API的响应格式差异

## 5. 用户故事优先级

**高优先级：**
- 2.1 模型选择界面
- 2.2 阿里云百炼API集成
- 2.3 统一的AI调用接口

**中优先级：**
- 2.4 现有功能兼容性
- 2.5 用户体验优化

## 6. 验收测试场景

### 6.1 基本功能测试
1. 用户可以在设置中选择AI模型
2. 用户可以配置阿里云百炼API Key
3. 切换模型后所有功能正常工作
4. API调用错误时显示合适的错误信息

### 6.2 兼容性测试
1. 现有Gemini用户无需重新配置
2. 新用户可以选择任一模型开始使用
3. 模型切换不影响用户个人资料设置

### 6.3 错误处理测试
1. 无效API Key时的错误提示
2. 网络错误时的降级处理
3. 模型服务不可用时的用户提示

## 7. 里程碑

**阶段1：基础架构** (预计2-3天)
- 创建AI服务抽象层
- 实现阿里云百炼API集成
- 添加模型选择UI

**阶段2：功能集成** (预计2-3天)  
- 更新所有现有功能以支持新架构
- 实现统一错误处理
- 添加用户体验优化

**阶段3：测试和优化** (预计1-2天)
- 全面测试所有功能
- 性能优化
- 文档更新