<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³åˆæˆæµ‹è¯•</title>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            text-align: center;
        }
        .test-btn { 
            background: #e11d48; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
        }
        .test-btn:hover { background: #be185d; }
        .test-btn:disabled { background: #666; cursor: not-allowed; }
        .status { 
            margin: 20px 0; 
            padding: 15px; 
            background: #333; 
            border-radius: 5px; 
            min-height: 50px;
        }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
    </style>
</head>
<body>
    <h1>ğŸ”Š è¯­éŸ³åˆæˆæµ‹è¯•</h1>
    <div id="status" class="status">ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•è¯­éŸ³åŠŸèƒ½</div>
    
    <div>
        <button class="test-btn" onclick="testBasicTTS()">åŸºç¡€è¯­éŸ³æµ‹è¯•</button>
        <button class="test-btn" onclick="testVoiceTypes()">éŸ³è‰²æµ‹è¯•</button>
        <button class="test-btn" onclick="stopSpeech()">åœæ­¢æ’­æ”¾</button>
    </div>
    
    <div>
        <button class="test-btn" onclick="checkSupport()">æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</button>
        <button class="test-btn" onclick="listVoices()">åˆ—å‡ºå¯ç”¨å£°éŸ³</button>
    </div>
    
    <script>
        const statusDiv = document.getElementById('status');
        
        function updateStatus(message, type = 'info') {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            console.log(`[TTS Test] ${message}`);
        }
        
        function testBasicTTS() {
            updateStatus('æ­£åœ¨æµ‹è¯•åŸºç¡€è¯­éŸ³åˆæˆ...');
            
            if (!window.speechSynthesis) {
                updateStatus('âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ', 'error');
                return;
            }
            
            try {
                const utterance = new SpeechSynthesisUtterance('ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯­éŸ³æµ‹è¯•ã€‚');
                utterance.lang = 'zh-CN';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                
                utterance.onstart = () => {
                    updateStatus('âœ… è¯­éŸ³æ’­æ”¾å¼€å§‹', 'success');
                };
                
                utterance.onend = () => {
                    updateStatus('âœ… è¯­éŸ³æ’­æ”¾å®Œæˆ', 'success');
                };
                
                utterance.onerror = (event) => {
                    updateStatus(`âŒ è¯­éŸ³æ’­æ”¾é”™è¯¯: ${event.error}`, 'error');
                };
                
                window.speechSynthesis.speak(utterance);
                
            } catch (error) {
                updateStatus(`âŒ è¯­éŸ³åˆæˆå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testVoiceTypes() {
            updateStatus('æ­£åœ¨æµ‹è¯•ä¸åŒéŸ³è‰²...');
            
            const tests = [
                { text: 'è¿‡æ¥ï¼Œä¸ç”¨è¯´è¯ï¼Œå¬æˆ‘å°±å¥½ã€‚', pitch: 0.7, rate: 0.8, name: 'ä½æ²‰éŸ³' },
                { text: 'åˆ«ç¦»æˆ‘å¤ªè¿‘ï¼Œæˆ‘æ€•æ§åˆ¶ä¸ä½ã€‚', pitch: 1.2, rate: 1.0, name: 'æ¸…è„†éŸ³' },
                { text: 'æŠŠæ‰‹ç»™æˆ‘ï¼Œæ…¢æ…¢æ¥ï¼Œæ²¡å…³ç³»çš„ã€‚', pitch: 0.5, rate: 0.85, name: 'æ¸©æŸ”éŸ³' }
            ];
            
            let currentTest = 0;
            
            function playNext() {
                if (currentTest >= tests.length) {
                    updateStatus('âœ… æ‰€æœ‰éŸ³è‰²æµ‹è¯•å®Œæˆ', 'success');
                    return;
                }
                
                const test = tests[currentTest];
                updateStatus(`æ­£åœ¨æ’­æ”¾: ${test.name}`);
                
                const utterance = new SpeechSynthesisUtterance(test.text);
                utterance.lang = 'zh-CN';
                utterance.pitch = test.pitch;
                utterance.rate = test.rate;
                utterance.volume = 0.9;
                
                utterance.onend = () => {
                    currentTest++;
                    setTimeout(playNext, 500); // é—´éš”500msæ’­æ”¾ä¸‹ä¸€ä¸ª
                };
                
                utterance.onerror = (event) => {
                    updateStatus(`âŒ ${test.name} æ’­æ”¾å¤±è´¥: ${event.error}`, 'error');
                };
                
                window.speechSynthesis.speak(utterance);
            }
            
            playNext();
        }
        
        function stopSpeech() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
                updateStatus('ğŸ›‘ è¯­éŸ³æ’­æ”¾å·²åœæ­¢');
            }
        }
        
        function checkSupport() {
            const support = {
                speechSynthesis: !!window.speechSynthesis,
                speechRecognition: !!(window.SpeechRecognition || window.webkitSpeechRecognition),
                audioContext: !!(window.AudioContext || window.webkitAudioContext)
            };
            
            let message = 'æµè§ˆå™¨æ”¯æŒæƒ…å†µ:\n';
            message += `â€¢ è¯­éŸ³åˆæˆ: ${support.speechSynthesis ? 'âœ…' : 'âŒ'}\n`;
            message += `â€¢ è¯­éŸ³è¯†åˆ«: ${support.speechRecognition ? 'âœ…' : 'âŒ'}\n`;
            message += `â€¢ éŸ³é¢‘ä¸Šä¸‹æ–‡: ${support.audioContext ? 'âœ…' : 'âŒ'}`;
            
            updateStatus(message);
        }
        
        function listVoices() {
            if (!window.speechSynthesis) {
                updateStatus('âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ', 'error');
                return;
            }
            
            const voices = window.speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                updateStatus('æ­£åœ¨åŠ è½½è¯­éŸ³åˆ—è¡¨ï¼Œè¯·ç¨åå†è¯•...');
                // æœ‰äº›æµè§ˆå™¨éœ€è¦æ—¶é—´åŠ è½½è¯­éŸ³åˆ—è¡¨
                setTimeout(listVoices, 1000);
                return;
            }
            
            const chineseVoices = voices.filter(voice => 
                voice.lang.includes('zh') || voice.lang.includes('CN')
            );
            
            let message = `æ‰¾åˆ° ${voices.length} ä¸ªè¯­éŸ³ï¼Œå…¶ä¸­ ${chineseVoices.length} ä¸ªä¸­æ–‡è¯­éŸ³:\n`;
            chineseVoices.forEach((voice, index) => {
                message += `${index + 1}. ${voice.name} (${voice.lang})\n`;
            });
            
            if (chineseVoices.length === 0) {
                message += '\nâš ï¸ æœªæ‰¾åˆ°ä¸­æ–‡è¯­éŸ³ï¼Œå°†ä½¿ç”¨é»˜è®¤è¯­éŸ³';
            }
            
            updateStatus(message);
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ”¯æŒæƒ…å†µ
        window.onload = () => {
            checkSupport();
            
            // ç›‘å¬è¯­éŸ³åˆ—è¡¨åŠ è½½å®Œæˆ
            if (window.speechSynthesis) {
                window.speechSynthesis.onvoiceschanged = () => {
                    console.log('è¯­éŸ³åˆ—è¡¨å·²åŠ è½½');
                };
            }
        };
    </script>
</body>
</html>